define("async",[],function(){function e(e){var t,n;t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src=e,n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n)}function t(e,t){var n=/!(.+)/,a=e.replace(n,""),r=n.test(e)?e.replace(/.+!/,""):o;return a+=a.indexOf("?")<0?"?":"&",a+r+"="+t}function n(){return a+=1,"__async_req_"+a+"__"}var o="callback",a=0;return{load:function(o,a,r,i){if(i.isBuild)r(null);else{var s=n();window[s]=r,e(t(a.toUrl(o),s))}}}}),define("mapsetup",["gmaps"],function(e){"use strict";var t={center:{lat:36.771,lng:-104.482},mapTypeId:e.MapTypeId.TERRAIN,zoom:8};return new e.Map(document.getElementById("map-canvas"),t)}),define("smarker",["gmaps"],function(e){function t(e,t){function n(){}n.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new n,e.prototype.constructor=e}var n,o,a={};return function(){var r="https://chart.googleapis.com/chart?chst=",i=e,s=i.Point,c=i.event,l=i.MarkerImage;n=function(e){i.Marker.call(this);var t=this,n=t.styleIcon=e.styleIcon;t.bindTo("icon",n),t.bindTo("shadow",n),t.bindTo("shape",n),t.setOptions(e)},t(n,i.Marker),o=function(e,t,n){function o(){var t=document.createElement("img"),n=document.createElement("img");c.addDomListenerOnce(n,"load",function(){var t=n.width,o=n.height;i.set(p,new l(e.getShadowURL(i),null,null,e.getShadowAnchor(i,t,o))),simage=null}),c.addDomListenerOnce(t,"load",function(){var n=t.width,o=t.height;i.set(s,new l(e.getURL(i),null,null,e.getAnchor(i,n,o))),i.set(d,e.getShape(i,n,o)),t=null}),t.src=e.getURL(i),n.src=e.getShadowURL(i)}var r,i=this,s="icon",p="shadow",d="shape",u=[];if(i.as_=function(e){u.push(e);for(r in t)e.set(r,t[r])},e!==a.CLASS){for(r in e.defaults)i.set(r,e.defaults[r]);i.setValues(t),i.set(s,e.getURL(i)),i.set(p,e.getShadowURL(i)),n&&n.as_(i),o(),i.changed=function(e){e!==s&&e!==d&&e!==p&&o()}}else i.setValues(t),i.changed=function(e){for(t[e]=i.get(e),r=0;r<u.length;r++)u[r].set(e,i.get(e))},n&&n.as_(i)},o.prototype=new i.MVCObject,a.CLASS={},a.MARKER={defaults:{text:"",color:"00ff00",fore:"000000",starcolor:null},getURL:function(e){var t,n=e.get("starcolor"),o=e.get("text"),a=e.get("color").replace(/#/,""),i=e.get("fore").replace(/#/,"");return t=n?r+"d_map_xpin_letter&chld=pin_star|":r+"d_map_pin_letter&chld=",o&&(o=o.substr(0,2)),t+=o+"|",t+=a+"|",t+=i,n&&(t+="|"+n.replace(/#/,"")),t},getShadowURL:function(e){return e.get("starcolor")?r+"d_map_xpin_shadow&chld=pin_star":r+"d_map_pin_shadow"},getAnchor:function(e,t,n){return new s(t/2,n)},getShadowAnchor:function(e,t,n){return new s(t/4,n)},getShape:function(e,t,n){var o={};o.coord=[t/2,n,7/16*t,5/8*n,5/16*t,7/16*n,7/32*t,5/16*n,5/16*t,1/8*n,.5*t,0,.6875*t,1/8*n,25/32*t,5/16*n,.6875*t,7/16*n,9/16*t,5/8*n];for(var a=0;a<o.coord.length;a++)o.coord[a]=Math.round(o.coord[a]);return o.type="poly",o}},a.BUBBLE={defaults:{text:"",color:"00ff00",fore:"000000"},getURL:function(e){var t=r+"d_bubble_text_small&chld=bb|";return t+=e.get("text")+"|",t+=e.get("color").replace(/#/,"")+"|",t+=e.get("fore").replace(/#/,"")},getShadowURL:function(e){return r+"d_bubble_text_small_shadow&chld=bb|"+e.get("text")},getAnchor:function(){return new google.maps.Point(0,42)},getShadowAnchor:function(){return new google.maps.Point(0,44)},getShape:function(e,t){var n={};return n.coord=[0,44,13,26,13,6,17,1,t-4,1,t,6,t,21,t-4,26,21,26],n.type="poly",n}}}(),{StyledMarker:n,StyledIcon:o,StyledIconTypes:a}}),define("utils",["jquery","lodash","gmaps","mapsetup","smarker"],function(e,t,n,o,a){"use strict";var r,i,s=e("#map-canvas").data("event");return t.templateSettings.variable="data",i={racerInfoBox:t.template(['<div class="info-box"><span class="info-points"><%= data.name %></span>','<span class="info-points"><a href="<%= data.bio %>"><%= data.nickname %></a></span></div>'].join("")),eventInfoBox:t.template(['<div class="info-box"><span class="info-points"><%= data.name %></span>','<span class="info-points"><%= data.description %></span></div>'].join(""))},r={getObjects:function(t){return e.getJSON(t,{event:s})},fixDates:function(e){e.timestamp=new Date(e.timestamp)},logger:function(e,t){var n=t||"error";console[n](e)},addLatLon:function(e){e.latLng=new n.LatLng(e.latitude,e.longitude)},createRacerPoint:function(e){var t=new a.StyledIcon(a.StyledIconTypes.BUBBLE,{color:e.color,text:e.nickname});e.marker=new a.StyledMarker({styleIcon:t,position:e.latLng,map:o,title:e.nickname}),e.infowindow=new n.InfoWindow({content:i.racerInfoBox(e)}),n.event.addListener(e.marker,"click",function(){e.infowindow.open(o,e.marker)})},createEventPoint:function(e){r.addLatLon(e);var t=new a.StyledIcon(a.StyledIconTypes.BUBBLE,{color:"#FCC200",text:e.name});e.marker=new a.StyledMarker({styleIcon:t,position:e.latLng,map:o,title:e.name}),e.infowindow=new n.InfoWindow({content:i.eventInfoBox(e)}),n.event.addListener(e.marker,"click",function(){e.infowindow.open(o,e.marker)})},drawTrack:function(e){var a=new n.Polyline({path:t.map(e,function(e){return e.latLng}),geodesic:!0,strokeColor:e[0].color,strokeOpacity:1,strokeWeight:2});a.setMap(o),e.track=a}}}),define("addracers",["lodash","utils"],function(e,t){"use strict";function n(){t.getObjects("/location").then(o.parseResponse,t.logger),a.__poll=setInterval(o.poll,3e5),window.__DEBUG_RACERS__={internal:a,api:o}}var o,a;return a={markers:[],cleanMarkers:function(t){e.forEach(a.markers,function(e){e.setMap(null)}),a.markers=t}},o={parseResponse:function(n){var o,r,i,s,c,l=[],p=e.groupBy(n.competitors,function(e){return e.spotId});for(i in p){if(p.hasOwnProperty(i))for(c=null,o=0,r=p[i].length;r>o;o+=1)s=p[i][o],t.fixDates(s),t.addLatLon(s),(null===c||s.timestamp>c.timestamp)&&(c=s);t.createRacerPoint(c),l.push(c.marker)}a.cleanMarkers(l),window.competitors=p,a.compStore=p},poll:function(){t.logger("polling","info"),t.getObjects("/location").then(o.parseResponse,t.logger)}},{init:n}}),define("addevents",["utils"],function(e){"use strict";function t(){e.getObjects("/racepoints").then(n.parseResponse,e.logger),window.__DEBUG_EVENTS__={internal:o,api:n}}var n,o;return o={},n={parseResponse:function(t){var n,a;for(n=0,a=t.race_points.length;a>n;n+=1)e.createEventPoint(t.race_points[n]);window.obstacles=t.race_points,o.obstacles=t.race_points}},{init:t}}),define("sidebar",["react","jquery"],function(e,t){"use strict";function n(){e.render(e.createElement(r,{source:"/competitors"}),o.cache.sideUl)}var o={cache:{sideUl:document.getElementById("competitorList"),ev:t("#map-canvas").data("event")},compCb:function(e){this.isMounted()&&this.setState({competitors:e.competitors})}},a=e.createClass({displayName:"Competitor",mixins:[e.addons.PureRenderMixin],render:function(){return e.createElement("li",null,e.createElement("div",{className:"competitor"},e.createElement("span",{className:"comp-info",style:{color:this.props.data.color}},this.props.data.name),e.createElement("span",{className:"comp-info"},e.createElement("a",{href:this.props.data.bio},this.props.data.nickname))))}}),r=e.createClass({displayName:"CompetitorList",getInitialState:function(){return{competitors:[]}},componentDidMount:function(){t.getJSON(this.props.source,{event:o.cache.ev},o.compCb.bind(this))},render:function(){var t=this.state.competitors.map(function(t){return e.createElement(a,{data:t,key:t.spotId})}.bind(this));return e.createElement("ul",null,t)}});return{load:n}}),function(){"use strict";requirejs.config({baseUrl:"/static/prod",paths:{jquery:"lib/jquery",react:"lib/react",lodash:"lib/lodash",async:"lib/require-async"}}),define("gmaps",["async!https://maps.googleapis.com/maps/api/js?key=AIzaSyDz4PRne46-U1AMqaoTmmplgTTOMNREixc"],function(){return window.google.maps}),requirejs(["thirdparty"],function(){require(["addracers","addevents","sidebar"],function(e,t,n){n.load(),t.init(),e.init()})})}(),define("app",function(){});
//# sourceMappingURL=app.js
//# sourceMappingURL=app.js.map